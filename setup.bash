#!/bin/bash
# This file is generated! Edit setup-script.bash instead. See README for more details.

# http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -euo pipefail
IFS=$'\n\t'

unameOut="$(uname -s)"
case "${unameOut}" in
    Linux*)     machine=Linux;;
    Darwin*)    machine=Mac;;
    CYGWIN*)    machine=Windows;;
    MINGW*)     machine=Windows;;
    *)          machine="UNKNOWN:${unameOut}"
esac


echo "Alloverse app setup wizard"
echo "--------------------------"

if [ -d "allo" ]; then
    echo "Project already initialized; use \`./allo/assist upgrade\` to fetch latest version."
    exit
fi

PROJNAME=`basename $(pwd)`

read -p "Create new project '$PROJNAME'? (Y/n) " answer
if [ "$answer" == "n" ] ; then
    echo "Exiting..."
    exit
fi

if [ ! -d ".git" ]; then
    echo "git init'ing"
    git init
fi

echo
echo "EXTRACTING template app..."

if [[ "$machine" == "Mac" ]]
then
    baseargs="-D"
else
    baseargs="-d"
fi
base64 $baseargs <<EOF | tar xz
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
EOF

sed -i".bak" "s#__PROJNAME__#${PROJNAME}#g" lua/main.lua
rm lua/main.lua.bak

echo
echo "FETCHING git dependencies..."

mkdir -p allo/deps
git submodule add -f https://github.com/alloverse/alloui-lua allo/deps/alloui
git submodule update --init --recursive allo/deps/alloui
git submodule add -f https://github.com/luapower/luajit.git allo/deps/luajit-bin

echo
echo "DOWNLOADING libraries using assist..."

./allo/assist upgrade
