#!/bin/bash
# This file is generated! Edit setup-script.bash instead. See README for more details.

# http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -euo pipefail
IFS=$'\n\t'

unameOut="$(uname -s)"
case "${unameOut}" in
    Linux*)     machine=Linux;;
    Darwin*)    machine=Mac;;
    CYGWIN*)    machine=Windows;;
    MINGW*)     machine=Windows;;
    *)          machine="UNKNOWN:${unameOut}"
esac


echo "Alloverse app setup wizard"
echo "--------------------------"

if [ -d "allo" ]; then
    echo "Project already initialized; use \`./allo/assist upgrade\` to fetch latest version."
    exit
fi

PROJNAME=`basename $(pwd)`

read -p "Create new project '$PROJNAME'? (Y/n) " answer
if [ "$answer" == "n" ] ; then
    echo "Exiting..."
    exit
fi

if [ ! -d ".git" ]; then
    echo "git init'ing"
    git init
fi

echo
echo "EXTRACTING template app..."

if [[ "$machine" == "Mac" ]]
then
    baseargs="-D"
else
    baseargs="-d"
fi
base64 $baseargs <<EOF | tar xz
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
EOF

sed -i".bak" "s#__PROJNAME__#${PROJNAME}#g" lua/main.lua
rm lua/main.lua.bak

echo
echo "FETCHING git dependencies..."

mkdir -p allo/deps
git submodule add -f https://github.com/alloverse/alloui-lua allo/deps/alloui
git submodule update --init --recursive allo/deps/alloui
git submodule add -f https://github.com/luapower/luajit.git allo/deps/luajit-bin

echo
echo "DOWNLOADING libraries using assist..."

./allo/assist upgrade
