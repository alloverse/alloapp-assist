#!/bin/bash
# This file is generated! Edit setup-script.bash instead. See README for more details.

# http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -euo pipefail
IFS=$'\n\t'

unameOut="$(uname -s)"
case "${unameOut}" in
    Linux*)     machine=Linux;;
    Darwin*)    machine=Mac;;
    CYGWIN*)    machine=Windows;;
    MINGW*)     machine=Windows;;
    *)          machine="UNKNOWN:${unameOut}"
esac


echo "Alloverse app setup wizard"
echo "--------------------------"

if [ -d "allo" ]; then
    echo "Project already initialized; use \`./allo/assist upgrade\` to fetch latest version."
    exit
fi

PROJNAME=`basename $(pwd)`

read -p "Create new project '$PROJNAME'? (Y/n) " answer
if [ "$answer" == "n" ] ; then
    echo "Exiting..."
    exit
fi

if [ ! -d ".git" ]; then
    echo "git init'ing"
    git init
fi

echo
echo "EXTRACTING template app..."

if [[ "$machine" == "Mac" ]]
then
    baseargs="-D"
else
    baseargs="-d"
fi
base64 $baseargs <<EOF | tar xz
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
EOF

sed -i".bak" "s#__PROJNAME__#${PROJNAME}#g" lua/main.lua
rm lua/main.lua.bak

echo
echo "FETCHING git dependencies..."

mkdir -p allo/deps
git submodule add -f https://github.com/alloverse/alloui-lua allo/deps/alloui
git submodule update --init --recursive allo/deps/alloui
git submodule add -f https://github.com/luapower/luajit.git allo/deps/luajit-bin

echo
echo "DOWNLOADING libraries using assist..."

./allo/assist upgrade
